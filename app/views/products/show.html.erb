<% provide :page_title, (@product.display_name.presence || @product.name.presence || "Товар ##{@product.id}") %>
<% provide :has_banner, true %>

<div class="page-banner">
  <div class="container page-banner__inner d-flex align-items-center gap-2">
    <div class="page-banner__title">
      <i class="bi bi-box-seam"></i> Товар
    </div>

    <div class="d-flex align-items-center gap-2 ms-auto">
      <%= link_to store_path, class: "btn btn-sm btn-outline-dark", title: "Магазин" do %>
        <i class="bi bi-shop"></i><span class="ms-1 d-none d-sm-inline">Магазин</span>
      <% end %>
      <%= link_to products_path, class: "btn btn-sm btn-outline-dark", title: "Каталог" do %>
        <i class="bi bi-card-list"></i><span class="ms-1 d-none d-sm-inline">Каталог</span>
      <% end %>
    </div>
  </div>
</div>

<div class="page-banner-spacer"></div>

<div class="row g-4 with-fixed-banner-anchor">
  <div class="col-12 col-lg-8 vstack gap-4">
    <div class="card shadow-sm">
      <div class="card-header">
        <strong><%= @product.display_name.presence || @product.name.presence || "Товар ##{@product.id}" %></strong>
      </div>
      <div class="card-body">
        <% if @product.description.present? %>
          <%= simple_format(@product.description) %>
        <% else %>
          <div class="text-muted">Описание не заполнено.</div>
        <% end %>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header"><strong>Фото</strong></div>
      <div class="card-body">
        <% if @product.images.any? %>
          <div class="row g-2">
            <% @product.images.each do |image| %>
              <div class="col-6 col-md-4 col-lg-3">
                <%= image_tag(image.url, class: "img-fluid rounded shadow-sm") %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-muted">Нет фотографий.</div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-4 vstack gap-4">
    <turbo-frame id="product_details_frame"
                 src="<%= product_description_product_path(@product, format: :turbo_stream, _ts: Time.now.to_i) %>">
      <div class="card shadow-sm">
        <div class="card-body text-muted text-center py-5">Загружаем детали…</div>
      </div>
    </turbo-frame>
  </div>
</div>

<div class="page-bottom-spacer"></div>
